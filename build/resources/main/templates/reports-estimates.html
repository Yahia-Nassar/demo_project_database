<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Estimate Accuracy</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
<div class="page">
    <header class="page-header">
        <div>
            <h1 class="page-title">Estimate vs Actual</h1>
            <p class="muted">Track accuracy across completed tasks.</p>
        </div>
        <div th:replace="fragments/nav :: nav"></div>
    </header>

    <div class="card" style="margin-bottom: 16px;">
        <p class="muted">
            Tip: create tasks from the Sprint Board and open each task to add estimate and actual hours.
        </p>
        <div class="form-row">
            <a href="/board/sprint" class="btn btn-primary">Go to Sprint Board</a>
        </div>
    </div>

    <div class="card" style="margin-bottom: 16px;">
        <canvas id="estimateChart" width="800" height="400"></canvas>
    </div>

    <div class="card">
        <table class="table">
            <thead>
            <tr>
                <th>Task</th>
                <th>Estimate (h)</th>
                <th>Actual (h)</th>
                <th>Completed</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="task : ${tasks}">
                <td th:text="${task.title}"></td>
                <td th:text="${task.estimateHours != null ? task.estimateHours : '—'}"></td>
                <td th:text="${task.actualHours != null ? task.actualHours : '—'}"></td>
                <td th:text="${task.completedAt != null ? task.completedAt : '—'}"></td>
                <td>
                    <form th:action="@{/tasks/{id}/edit(id=${task.id})}" method="get">
                        <button type="submit" class="btn btn-outline">Edit task</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script th:inline="javascript">
/*<![CDATA[*/
    const labels = /*[[${labels}]]*/ [];
    const estimates = /*[[${estimates}]]*/ [];
    const actuals = /*[[${actuals}]]*/ [];
/*]]>*/

    const ctx = document.getElementById('estimateChart');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Estimate (h)',
                    data: estimates,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)'
                },
                {
                    label: 'Actual (h)',
                    data: actuals,
                    backgroundColor: 'rgba(255, 99, 132, 0.5)'
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

</body>
</html>